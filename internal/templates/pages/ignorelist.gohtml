{{define "pages/ignorelist"}}
<div class="space-y-6 stagger">
    <!-- Page Header -->
    <div class="card bg-base-200">
        <div class="card-body">
            <h1 class="text-3xl font-bold text-base-content">Ignore List</h1>
            <p class="text-base-content/60 mt-2">Manage players that won't trigger alerts or be shown on radar.</p>
        </div>
    </div>

    <!-- Add Player -->
    <div class="card bg-base-200">
        <div class="card-body">
            <h2 class="text-xl font-semibold text-base-content mb-4">Add Player</h2>
            <div class="flex gap-3">
                <input type="text"
                       id="ignorePlayerInput"
                       placeholder="Enter player name..."
                       class="input input-bordered flex-1">
                <button id="addIgnoreBtn" class="btn btn-primary">Add</button>
            </div>
            <p class="text-xs text-base-content/50 mt-2">Players on this list will not trigger sound alerts or screen flashes.</p>
        </div>
    </div>

    <!-- Ignored Players List -->
    <div class="card bg-base-200">
        <div class="card-body">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-base-content">Ignored Players</h2>
                <span id="ignoreCount" class="badge badge-ghost font-mono">0</span>
            </div>

            <div id="ignoreListContainer" class="space-y-2">
                <!-- Players will be rendered here -->
                <p id="emptyIgnoreList" class="text-base-content/50 text-center py-8 italic">
                    No players on ignore list
                </p>
            </div>
        </div>
    </div>
</div>
{{end}}

{{define "scripts/ignorelist"}}
<script>
window.onGlobalsReady(function initIgnoreListPage() {
    const settingsSync = window.settingsSync;

    const input = document.getElementById('ignorePlayerInput');
    const addBtn = document.getElementById('addIgnoreBtn');
    const container = document.getElementById('ignoreListContainer');
    const countEl = document.getElementById('ignoreCount');
    const emptyEl = document.getElementById('emptyIgnoreList');

    function getIgnoreList() {
        return settingsSync.getJSON('ignoreList', []);
    }

    function saveIgnoreList(list) {
        settingsSync.setJSON('ignoreList', list);
        renderList();
    }

    function renderList() {
        const list = getIgnoreList();
        countEl.textContent = list.length;

        if (list.length === 0) {
            emptyEl.style.display = 'block';
            container.querySelectorAll('.player-item').forEach(el => el.remove());
            return;
        }

        emptyEl.style.display = 'none';
        container.querySelectorAll('.player-item').forEach(el => el.remove());

        list.forEach((name, index) => {
            const div = document.createElement('div');
            div.className = 'player-item flex items-center justify-between p-3 bg-base-300 rounded-lg group';
            div.innerHTML = `
                <span class="text-base-content font-medium">${escapeHtml(name)}</span>
                <button class="remove-btn btn btn-ghost btn-xs text-error opacity-0 group-hover:opacity-100 transition-opacity">
                    Remove
                </button>
            `;
            div.querySelector('.remove-btn').addEventListener('click', () => {
                const newList = getIgnoreList().filter((_, i) => i !== index);
                saveIgnoreList(newList);
            });
            container.appendChild(div);
        });
    }

    function addPlayer() {
        const name = input.value.trim();
        if (!name) return;

        const list = getIgnoreList();
        if (list.includes(name)) {
            input.value = '';
            return;
        }

        list.push(name);
        saveIgnoreList(list);
        input.value = '';
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    addBtn.addEventListener('click', addPlayer);
    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addPlayer();
    });

    renderList();
});
</script>
{{end}}
