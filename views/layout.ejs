<!DOCTYPE html>
<html class="dark" x-data="data()" lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenRadar - Albion Online Radar</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="/scripts/styles/tooltips.css" />

    <!-- üìä Global Logger -->
    <script type="module" src="/scripts/constants/LoggerConstants.js"></script>
    <script type="module" src="/scripts/LoggerClient.js"></script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="/scripts/init-alpine.js"></script>

    <!-- jQuery & SignalR -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/9.0.6/signalr.min.js" ></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <div class="flex h-screen bg-gray-900" :class="{ 'overflow-hidden': isSideMenuOpen }">

    <!-- Desktop Sidebar -->
    <aside
      :class="{'w-64': !sidebarCollapsed || sidebarHoverExpanded, 'w-20': sidebarCollapsed && !sidebarHoverExpanded}"
      class="z-20 hidden md:block flex-shrink-0 overflow-y-auto bg-gray-800 transition-all duration-500"
      @mouseenter="onSidebarMouseEnter"
      @mouseleave="onSidebarMouseLeave"
    >
      <div class="py-4 text-gray-300">
        <!-- Header -->
        <div class="flex items-center justify-between px-6">
          <a x-show="!sidebarCollapsed || sidebarHoverExpanded" class="text-lg font-bold text-gray-200" href="#">
            OpenRadar
          </a>
          <button
            @click="toggleSidebar"
            :class="{'ml-auto': sidebarCollapsed && !sidebarHoverExpanded}"
            class="p-1 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
            :title="sidebarCollapsed ? 'Expand sidebar' : 'Collapse sidebar'"
          >
            <i data-lucide="menu" class="w-6 h-6"></i>
          </button>
        </div>

        <!-- Menu Items -->
        <ul class="mt-6">
          <template x-for="item in menuItems" :key="item.path">
            <li class="relative px-6 py-3">
              <!-- Active Indicator -->
              <span x-show="currentPath === item.path" class="absolute inset-y-0 left-0 w-1 bg-purple-600 rounded-tr-lg rounded-br-lg"></span>

              <a
                :href="item.path"
                :class="{
                  'text-white': currentPath === item.path,
                  'text-gray-400 hover:text-gray-200': currentPath !== item.path,
                  'justify-center': sidebarCollapsed && !sidebarHoverExpanded
                }"
                class="inline-flex items-center w-full text-sm font-semibold transition-colors duration-150"
                :title="(sidebarCollapsed && !sidebarHoverExpanded) ? item.label : ''"
              >
                <i :data-lucide="item.icon" :class="{'mr-0': sidebarCollapsed && !sidebarHoverExpanded}" class="w-5 h-5 mr-3"></i>
                <span x-show="!sidebarCollapsed || sidebarHoverExpanded" x-text="item.label"></span>
              </a>
            </li>
          </template>
        </ul>
      </div>
    </aside>

    <!-- Mobile Sidebar -->
    <!-- Backdrop -->
    <div
      x-show="isSideMenuOpen"
      x-transition.opacity.duration.150ms
      @click="closeSideMenu"
      class="fixed inset-0 z-10 bg-black bg-opacity-50 md:hidden"
    ></div>

    <!-- Mobile Menu -->
    <aside
      x-show="isSideMenuOpen"
      x-transition.duration.150ms
      @click.outside="closeSideMenu"
      @keydown.escape="closeSideMenu"
      class="fixed inset-y-0 left-0 z-20 w-64 overflow-y-auto bg-gray-800 md:hidden"
    >
      <div class="py-4 text-gray-300">
        <a class="ml-6 text-lg font-bold text-gray-200" href="#">OpenRadar</a>

        <ul class="mt-6">
          <template x-for="item in menuItems" :key="item.path">
            <li class="relative px-6 py-3">
              <span x-show="currentPath === item.path" class="absolute inset-y-0 left-0 w-1 bg-purple-600 rounded-tr-lg rounded-br-lg"></span>
              <a
                :href="item.path"
                :class="{'text-white': currentPath === item.path, 'text-gray-400 hover:text-gray-200': currentPath !== item.path}"
                class="inline-flex items-center w-full text-sm font-semibold transition-colors"
              >
                <i :data-lucide="item.icon" class="w-5 h-5 mr-3"></i>
                <span x-text="item.label"></span>
              </a>
            </li>
          </template>
        </ul>
      </div>
    </aside>

    <!-- Main Content Area -->
    <div class="flex flex-col flex-1 w-full">
      <!-- Header -->
      <header class="z-10 py-4 bg-gray-800 shadow-md">
        <div class="container flex items-center justify-between h-full px-6 mx-auto text-purple-400">
          <!-- Mobile Menu Button -->
          <button
            @click="toggleSideMenu"
            class="p-1 -ml-1 rounded-md md:hidden focus:outline-none focus:ring-2 focus:ring-purple-500"
          >
            <i data-lucide="menu" class="w-6 h-6"></i>
          </button>

          <div class="flex-1"></div>

          <!-- Right Side Items -->
          <ul class="flex items-center space-x-6">
            <!-- Placeholder for future items (notifications, profile, etc.) -->
          </ul>
        </div>
      </header>

      <!-- Main Content -->
      <main class="h-full overflow-y-auto bg-gray-900">
        <%- include(mainContent) %>
      </main>
    </div>
  </div>

  <script>
    document.addEventListener('alpine:initialized', () => {
      lucide.createIcons();
    });

    // üñ•Ô∏è Send server logs state to backend on app startup
    (async () => {
      try {
        const enabled = localStorage.getItem("settingServerLogsEnabled");
        const serverLogsEnabled = enabled === null ? false : enabled === "true";

        const response = await fetch('/api/settings/server-logs', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ enabled: serverLogsEnabled })
        });

        const result = await response.json();

        if (result.success) {
          console.log(`üñ•Ô∏è [Layout] Server-side logging initialized: ${serverLogsEnabled ? 'ENABLED' : 'DISABLED'}`);
        } else {
          console.error('‚ùå [Layout] Failed to initialize server logs setting');
        }
      } catch (error) {
        console.error('‚ùå [Layout] Error initializing server logs setting:', error);
      }
    })();
  </script>
</body>
</html>